{"version":3,"sources":["../../src/lib/patch-incorrect-lockfile.ts"],"names":["patchIncorrectLockfile","Log","registry","fetchPkgInfo","pkg","getRegistry","res","fetch","ok","Error","status","data","json","versionData","versions","nextPkgJson","version","os","cpu","engines","tarball","dist","integrity","dir","process","env","NEXT_IGNORE_INCORRECT_LOCKFILE","lockfilePath","findUp","cwd","content","promises","readFile","endingNewline","endsWith","lockfileParsed","JSON","parse","lockfileVersion","parseInt","expectedSwcPkgs","Object","keys","optionalDependencies","patchDependency","pkgData","dependencies","resolved","optional","patchPackage","packages","supportedVersions","includes","shouldPatchDependencies","shouldPatchPackages","missingSwcPkgs","pkgPrefix","substring","length","push","warn","isCI","pkgsData","Promise","all","map","i","writeFile","stringify","err","error","console"],"mappings":"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"}