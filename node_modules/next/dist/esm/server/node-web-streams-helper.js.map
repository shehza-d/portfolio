{"version":3,"sources":["../../src/server/node-web-streams-helper.ts"],"names":["nonNullable","getTracer","AppRenderSpan","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","encodeText","input","TextEncoder","encode","decodeText","textDecoder","decode","stream","readableStreamTee","readable","transformStream","TransformStream","transformStream2","writer","writable","getWriter","writer2","reader","getReader","read","then","done","value","close","write","chainStreams","streams","promise","Promise","resolve","i","length","pipeTo","preventClose","streamFromArray","strings","forEach","str","streamToString","TextDecoder","bufferedString","createBufferedTransformStream","transform","v","pendingFlush","flushBuffer","controller","buffered","enqueue","chunk","flush","createInsertedHTMLStream","getServerInsertedHTML","insertedHTMLChunk","renderToInitialStream","ReactDOMServer","element","streamOptions","trace","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","createDeferredSuffixStream","suffix","suffixFlushed","suffixFlushTask","res","createInlineDataStream","dataStream","dataStreamFinished","dataStreamReader","err","error","createSuffixStream","createRootLayoutValidatorStream","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","JSON","stringify","tree","continueFromInitialStream","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","serverInsertedHTML","reduce","pipeThrough"],"mappings":"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"}