{"version":3,"sources":["../../../../src/server/lib/incremental-cache/file-system-cache.ts"],"names":["LRUCache","path","memoryCache","FileSystemCache","constructor","ctx","fs","flushToDisk","serverDistDir","appDir","_appDir","maxMemoryCacheSize","max","length","value","JSON","kind","stringify","props","Error","data","body","html","pageData","get","key","fetchCache","process","env","NEXT_RUNTIME","filePath","getFsPath","pathname","fileData","readFile","mtime","stat","meta","parse","replace","cacheEntry","lastModified","getTime","Buffer","from","headers","status","_","isAppPath","set","Date","now","mkdir","dirname","writeFile","htmlPath","join","err"],"mappings":"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"}