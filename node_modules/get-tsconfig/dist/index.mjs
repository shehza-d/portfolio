import g from"path";import E from"fs";import cn from"module";function L(n){return/^\\\\\?\\/.test(n)?n:n.replace(/\\/g,"/")}function W(n,o){for(;;){const t=g.posix.join(n,o);if(E.existsSync(t))return t;const e=g.dirname(n);if(e===n)return;n=e}}const x=/^\.{1,2}(\/.*)?$/,M=n=>L(x.test(n)?n:`./${n}`);function un(n,o=!1){const t=n.length;let e=0,i="",s=0,l=16,a=0,u=0,j=0,k=0,p=0;function F(c,r){let f=0,v=0;for(;f<c||!r;){let T=n.charCodeAt(e);if(T>=48&&T<=57)v=v*16+T-48;else if(T>=65&&T<=70)v=v*16+T-65+10;else if(T>=97&&T<=102)v=v*16+T-97+10;else break;e++,f++}return f<c&&(v=-1),v}function U(c){e=c,i="",s=0,l=16,p=0}function A(){let c=e;if(n.charCodeAt(e)===48)e++;else for(e++;e<n.length&&_(n.charCodeAt(e));)e++;if(e<n.length&&n.charCodeAt(e)===46)if(e++,e<n.length&&_(n.charCodeAt(e)))for(e++;e<n.length&&_(n.charCodeAt(e));)e++;else return p=3,n.substring(c,e);let r=e;if(e<n.length&&(n.charCodeAt(e)===69||n.charCodeAt(e)===101))if(e++,(e<n.length&&n.charCodeAt(e)===43||n.charCodeAt(e)===45)&&e++,e<n.length&&_(n.charCodeAt(e))){for(e++;e<n.length&&_(n.charCodeAt(e));)e++;r=e}else p=3;return n.substring(c,r)}function b(){let c="",r=e;for(;;){if(e>=t){c+=n.substring(r,e),p=2;break}const f=n.charCodeAt(e);if(f===34){c+=n.substring(r,e),e++;break}if(f===92){if(c+=n.substring(r,e),e++,e>=t){p=2;break}switch(n.charCodeAt(e++)){case 34:c+='"';break;case 92:c+="\\";break;case 47:c+="/";break;case 98:c+="\b";break;case 102:c+="\f";break;case 110:c+=`
`;break;case 114:c+="\r";break;case 116:c+="	";break;case 117:const T=F(4,!0);T>=0?c+=String.fromCharCode(T):p=4;break;default:p=5}r=e;continue}if(f>=0&&f<=31)if(N(f)){c+=n.substring(r,e),p=2;break}else p=6;e++}return c}function O(){if(i="",p=0,s=e,u=a,k=j,e>=t)return s=t,l=17;let c=n.charCodeAt(e);if(R(c)){do e++,i+=String.fromCharCode(c),c=n.charCodeAt(e);while(R(c));return l=15}if(N(c))return e++,i+=String.fromCharCode(c),c===13&&n.charCodeAt(e)===10&&(e++,i+=`
`),a++,j=e,l=14;switch(c){case 123:return e++,l=1;case 125:return e++,l=2;case 91:return e++,l=3;case 93:return e++,l=4;case 58:return e++,l=6;case 44:return e++,l=5;case 34:return e++,i=b(),l=10;case 47:const r=e-1;if(n.charCodeAt(e+1)===47){for(e+=2;e<t&&!N(n.charCodeAt(e));)e++;return i=n.substring(r,e),l=12}if(n.charCodeAt(e+1)===42){e+=2;const f=t-1;let v=!1;for(;e<f;){const T=n.charCodeAt(e);if(T===42&&n.charCodeAt(e+1)===47){e+=2,v=!0;break}e++,N(T)&&(T===13&&n.charCodeAt(e)===10&&e++,a++,j=e)}return v||(e++,p=1),i=n.substring(r,e),l=13}return i+=String.fromCharCode(c),e++,l=16;case 45:if(i+=String.fromCharCode(c),e++,e===t||!_(n.charCodeAt(e)))return l=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=A(),l=11;default:for(;e<t&&B(c);)e++,c=n.charCodeAt(e);if(s!==e){switch(i=n.substring(s,e),i){case"true":return l=8;case"false":return l=9;case"null":return l=7}return l=16}return i+=String.fromCharCode(c),e++,l=16}}function B(c){if(R(c)||N(c))return!1;switch(c){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function $(){let c;do c=O();while(c>=12&&c<=15);return c}return{setPosition:U,getPosition:()=>e,scan:o?$:O,getToken:()=>l,getTokenValue:()=>i,getTokenOffset:()=>s,getTokenLength:()=>e-s,getTokenStartLine:()=>u,getTokenStartCharacter:()=>s-k,getTokenError:()=>p}}function R(n){return n===32||n===9}function N(n){return n===10||n===13}function _(n){return n>=48&&n<=57}var P;(function(n){n[n.lineFeed=10]="lineFeed",n[n.carriageReturn=13]="carriageReturn",n[n.space=32]="space",n[n._0=48]="_0",n[n._1=49]="_1",n[n._2=50]="_2",n[n._3=51]="_3",n[n._4=52]="_4",n[n._5=53]="_5",n[n._6=54]="_6",n[n._7=55]="_7",n[n._8=56]="_8",n[n._9=57]="_9",n[n.a=97]="a",n[n.b=98]="b",n[n.c=99]="c",n[n.d=100]="d",n[n.e=101]="e",n[n.f=102]="f",n[n.g=103]="g",n[n.h=104]="h",n[n.i=105]="i",n[n.j=106]="j",n[n.k=107]="k",n[n.l=108]="l",n[n.m=109]="m",n[n.n=110]="n",n[n.o=111]="o",n[n.p=112]="p",n[n.q=113]="q",n[n.r=114]="r",n[n.s=115]="s",n[n.t=116]="t",n[n.u=117]="u",n[n.v=118]="v",n[n.w=119]="w",n[n.x=120]="x",n[n.y=121]="y",n[n.z=122]="z",n[n.A=65]="A",n[n.B=66]="B",n[n.C=67]="C",n[n.D=68]="D",n[n.E=69]="E",n[n.F=70]="F",n[n.G=71]="G",n[n.H=72]="H",n[n.I=73]="I",n[n.J=74]="J",n[n.K=75]="K",n[n.L=76]="L",n[n.M=77]="M",n[n.N=78]="N",n[n.O=79]="O",n[n.P=80]="P",n[n.Q=81]="Q",n[n.R=82]="R",n[n.S=83]="S",n[n.T=84]="T",n[n.U=85]="U",n[n.V=86]="V",n[n.W=87]="W",n[n.X=88]="X",n[n.Y=89]="Y",n[n.Z=90]="Z",n[n.asterisk=42]="asterisk",n[n.backslash=92]="backslash",n[n.closeBrace=125]="closeBrace",n[n.closeBracket=93]="closeBracket",n[n.colon=58]="colon",n[n.comma=44]="comma",n[n.dot=46]="dot",n[n.doubleQuote=34]="doubleQuote",n[n.minus=45]="minus",n[n.openBrace=123]="openBrace",n[n.openBracket=91]="openBracket",n[n.plus=43]="plus",n[n.slash=47]="slash",n[n.formFeed=12]="formFeed",n[n.tab=9]="tab"})(P||(P={}));var h;(function(n){n.DEFAULT={allowTrailingComma:!1}})(h||(h={}));function fn(n,o=[],t=h.DEFAULT){let e=null,i=[];const s=[];function l(u){Array.isArray(i)?i.push(u):e!==null&&(i[e]=u)}return rn(n,{onObjectBegin:()=>{const u={};l(u),s.push(i),i=u,e=null},onObjectProperty:u=>{e=u},onObjectEnd:()=>{i=s.pop()},onArrayBegin:()=>{const u=[];l(u),s.push(i),i=u,e=null},onArrayEnd:()=>{i=s.pop()},onLiteralValue:l,onError:(u,j,k)=>{o.push({error:u,offset:j,length:k})}},t),i[0]}function rn(n,o,t=h.DEFAULT){const e=un(n,!1),i=[];function s(m){return m?()=>m(e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter()):()=>!0}function l(m){return m?()=>m(e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter(),()=>i.slice()):()=>!0}function a(m){return m?w=>m(w,e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter()):()=>!0}function u(m){return m?w=>m(w,e.getTokenOffset(),e.getTokenLength(),e.getTokenStartLine(),e.getTokenStartCharacter(),()=>i.slice()):()=>!0}const j=l(o.onObjectBegin),k=u(o.onObjectProperty),p=s(o.onObjectEnd),F=l(o.onArrayBegin),U=s(o.onArrayEnd),A=u(o.onLiteralValue),b=a(o.onSeparator),O=s(o.onComment),B=a(o.onError),$=t&&t.disallowComments,c=t&&t.allowTrailingComma;function r(){for(;;){const m=e.scan();switch(e.getTokenError()){case 4:f(14);break;case 5:f(15);break;case 3:f(13);break;case 1:$||f(11);break;case 2:f(12);break;case 6:f(16);break}switch(m){case 12:case 13:$?f(10):O();break;case 16:f(1);break;case 15:case 14:break;default:return m}}}function f(m,w=[],H=[]){if(B(m),w.length+H.length>0){let I=e.getToken();for(;I!==17;){if(w.indexOf(I)!==-1){r();break}else if(H.indexOf(I)!==-1)break;I=r()}}}function v(m){const w=e.getTokenValue();return m?A(w):(k(w),i.push(w)),r(),!0}function T(){switch(e.getToken()){case 11:const m=e.getTokenValue();let w=Number(m);isNaN(w)&&(f(2),w=0),A(w);break;case 7:A(null);break;case 8:A(!0);break;case 9:A(!1);break;default:return!1}return r(),!0}function on(){return e.getToken()!==10?(f(3,[],[2,5]),!1):(v(!1),e.getToken()===6?(b(":"),r(),S()||f(4,[],[2,5])):f(5,[],[2,5]),i.pop(),!0)}function ln(){j(),r();let m=!1;for(;e.getToken()!==2&&e.getToken()!==17;){if(e.getToken()===5){if(m||f(4,[],[]),b(","),r(),e.getToken()===2&&c)break}else m&&f(6,[],[]);on()||f(4,[],[2,5]),m=!0}return p(),e.getToken()!==2?f(7,[2],[]):r(),!0}function sn(){F(),r();let m=!0,w=!1;for(;e.getToken()!==4&&e.getToken()!==17;){if(e.getToken()===5){if(w||f(4,[],[]),b(","),r(),e.getToken()===4&&c)break}else w&&f(6,[],[]);m?(i.push(0),m=!1):i[i.length-1]++,S()||f(4,[],[4,5]),w=!0}return U(),m||i.pop(),e.getToken()!==4?f(8,[4],[]):r(),!0}function S(){switch(e.getToken()){case 3:return sn();case 1:return ln();case 10:return v(!0);default:return T()}}return r(),e.getToken()===17?t.allowEmptyContent?!0:(f(4,[],[]),!1):S()?(e.getToken()!==17&&f(9,[],[]),!0):(f(4,[],[]),!1)}var X;(function(n){n[n.None=0]="None",n[n.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",n[n.UnexpectedEndOfString=2]="UnexpectedEndOfString",n[n.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",n[n.InvalidUnicode=4]="InvalidUnicode",n[n.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",n[n.InvalidCharacter=6]="InvalidCharacter"})(X||(X={}));var Y;(function(n){n[n.OpenBraceToken=1]="OpenBraceToken",n[n.CloseBraceToken=2]="CloseBraceToken",n[n.OpenBracketToken=3]="OpenBracketToken",n[n.CloseBracketToken=4]="CloseBracketToken",n[n.CommaToken=5]="CommaToken",n[n.ColonToken=6]="ColonToken",n[n.NullKeyword=7]="NullKeyword",n[n.TrueKeyword=8]="TrueKeyword",n[n.FalseKeyword=9]="FalseKeyword",n[n.StringLiteral=10]="StringLiteral",n[n.NumericLiteral=11]="NumericLiteral",n[n.LineCommentTrivia=12]="LineCommentTrivia",n[n.BlockCommentTrivia=13]="BlockCommentTrivia",n[n.LineBreakTrivia=14]="LineBreakTrivia",n[n.Trivia=15]="Trivia",n[n.Unknown=16]="Unknown",n[n.EOF=17]="EOF"})(Y||(Y={}));const pn=fn;var Z;(function(n){n[n.InvalidSymbol=1]="InvalidSymbol",n[n.InvalidNumberFormat=2]="InvalidNumberFormat",n[n.PropertyNameExpected=3]="PropertyNameExpected",n[n.ValueExpected=4]="ValueExpected",n[n.ColonExpected=5]="ColonExpected",n[n.CommaExpected=6]="CommaExpected",n[n.CloseBraceExpected=7]="CloseBraceExpected",n[n.CloseBracketExpected=8]="CloseBracketExpected",n[n.EndOfFileExpected=9]="EndOfFileExpected",n[n.InvalidCommentToken=10]="InvalidCommentToken",n[n.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",n[n.UnexpectedEndOfString=12]="UnexpectedEndOfString",n[n.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",n[n.InvalidUnicode=14]="InvalidUnicode",n[n.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",n[n.InvalidCharacter=16]="InvalidCharacter"})(Z||(Z={}));const q=n=>pn(E.readFileSync(n,"utf8")),{existsSync:D}=E,gn=()=>{const{findPnpApi:n}=cn;return n&&n(process.cwd())};function d(n){const o=q(n);return g.join(n,"..",o&&"tsconfig"in o?o.tsconfig:"tsconfig.json")}function mn(n,o){let t=n;const e=n[0]===".";if(e||g.isAbsolute(n)){if(e&&(t===".."&&(t+="/tsconfig.json"),t=g.resolve(o,t)),D(t)&&E.statSync(t).isFile()||!t.endsWith(".json")&&(t+=".json",D(t)))return t;throw new Error(`File '${n}' not found.`)}const i=gn();if(i){const{resolveRequest:l}=i,[a,u]=n.split("/"),j=a.startsWith("@")?`${a}/${u}`:a;try{if(j===n){const k=l(g.join(j,"package.json"),o);if(k){const p=d(k);if(D(p))return p}}else{let k;try{k=l(n,o,{extensions:[".json"]})}catch{k=l(g.join(n,"tsconfig.json"),o)}if(k)return k}}catch{}}let s=W(o,g.join("node_modules",t));if(s){if(E.statSync(s).isDirectory()){const l=g.join(s,"package.json");if(D(l)?s=d(l):s=g.join(s,"tsconfig.json"),D(s))return s}else if(s.endsWith(".json"))return s}if(!t.endsWith(".json")&&(t+=".json",s=W(o,g.join("node_modules",t)),s))return s;throw new Error(`File '${n}' not found.`)}function J(n){var o;let t;try{t=E.realpathSync(n)}catch{throw new Error(`Cannot resolve tsconfig at path: ${n}`)}const e=g.dirname(t);let i=q(t)||{};if(typeof i!="object")throw new SyntaxError(`Failed to parse tsconfig at: ${n}`);if(i.extends){const s=mn(i.extends,e),l=J(s);if(delete l.references,(o=l.compilerOptions)!=null&&o.baseUrl){const{compilerOptions:u}=l;u.baseUrl=g.relative(e,g.join(g.dirname(s),u.baseUrl))||"./"}l.files&&(l.files=l.files.map(u=>g.relative(e,g.join(g.dirname(s),u)))),l.include&&(l.include=l.include.map(u=>g.relative(e,g.join(g.dirname(s),u)))),delete i.extends;const a={...l,...i,compilerOptions:{...l.compilerOptions,...i.compilerOptions}};l.watchOptions&&(a.watchOptions={...l.watchOptions,...i.watchOptions}),i=a}if(i.compilerOptions){const{compilerOptions:s}=i;s.baseUrl&&(s.baseUrl=M(s.baseUrl)),s.outDir&&(Array.isArray(i.exclude)||(i.exclude=[]),i.exclude.push(s.outDir),s.outDir=M(s.outDir))}else i.compilerOptions={};if(i.files&&(i.files=i.files.map(M)),i.include&&(i.include=i.include.map(L)),i.watchOptions){const{watchOptions:s}=i;s.excludeDirectories&&(s.excludeDirectories=s.excludeDirectories.map(l=>L(g.resolve(e,l))))}return i}function an(n=process.cwd(),o="tsconfig.json"){const t=W(L(n),o);if(!t)return null;const e=J(t);return{path:t,config:e}}const kn=/\*/g,K=(n,o)=>{const t=n.match(kn);if(t&&t.length>1)throw new Error(o)};function bn(n){if(n.includes("*")){const[o,t]=n.split("*");return{prefix:o,suffix:t}}return n}const Tn=({prefix:n,suffix:o},t)=>t.startsWith(n)&&t.endsWith(o);function wn(n,o,t){return Object.entries(n).map(([e,i])=>(K(e,`Pattern '${e}' can have at most one '*' character.`),{pattern:bn(e),substitutions:i.map(s=>{if(K(s,`Substitution '${s}' in pattern '${e}' can have at most one '*' character.`),!o&&!x.test(s))throw new Error("Non-relative paths are not allowed when 'baseUrl' is not set. Did you forget a leading './'?");return g.join(t,s)})}))}function On(n){if(!n.config.compilerOptions)return null;const{baseUrl:o,paths:t}=n.config.compilerOptions;if(!o&&!t)return null;const e=g.resolve(g.dirname(n.path),o||"."),i=t?wn(t,o,e):[];return function(l){if(x.test(l))return[];const a=[];for(const p of i){if(p.pattern===l)return p.substitutions.map(L);typeof p.pattern!="string"&&a.push(p)}let u,j=-1;for(const p of a)Tn(p.pattern,l)&&p.pattern.prefix.length>j&&(j=p.pattern.prefix.length,u=p);if(!u)return o?[L(g.join(e,l))]:[];const k=l.slice(u.pattern.prefix.length,l.length-u.pattern.suffix.length);return u.substitutions.map(p=>L(p.replace("*",k)))}}const C=n=>{let o="";for(let t=0;t<n.length;t+=1){const e=n[t],i=e.toUpperCase();o+=e===i?e.toLowerCase():i}return o},jn=65,vn=97,An=()=>Math.floor(Math.random()*26),Ln=n=>Array.from({length:n},()=>String.fromCodePoint(An()+(Math.random()>.5?jn:vn))).join(""),Bn=(n=E)=>{const o=process.execPath;if(n.existsSync(o))return!n.existsSync(C(o));const t=`/${Ln(10)}`;n.writeFileSync(t,"");const e=!n.existsSync(C(t));return n.unlinkSync(t),e},{join:y}=g.posix,G={ts:[".ts",".tsx",".d.ts"],cts:[".cts",".d.cts"],mts:[".mts",".d.mts"]},En=n=>{const o=[...G.ts],t=[...G.cts],e=[...G.mts];return n!=null&&n.allowJs&&(o.push(".js",".jsx"),t.push(".cjs"),e.push(".mjs")),[...o,...t,...e]},Un=n=>{const o=[];if(!n)return o;const{outDir:t,declarationDir:e}=n;return t&&o.push(t),e&&o.push(e),o},nn=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),$n=["node_modules","bower_components","jspm_packages"],Q=`(?!(${$n.join("|")})(/|$))`,_n=/(?:^|\/)[^.*?]+$/,en="**/*",V="[^/]",z="[^./]",tn=process.platform==="win32",Fn=({config:n,path:o},t=Bn())=>{if("extends"in n)throw new Error("tsconfig#extends must be resolved. Use getTsconfig or parseTsconfig to resolve it.");if(!g.isAbsolute(o))throw new Error("The tsconfig path must be absolute");tn&&(o=L(o));const e=g.dirname(o),{files:i,include:s,exclude:l,compilerOptions:a}=n,u=i==null?void 0:i.map(b=>y(e,b)),j=En(a),k=t?"":"i",F=(l||Un(a)).map(b=>{const O=y(e,b),B=nn(O).replace(/\\\*\\\*\//g,"(.+/)?").replace(/\\\*/g,`${V}*`).replace(/\\\?/g,V);return new RegExp(`^${B}($|/)`,k)}),U=i||s?s:[en],A=U?U.map(b=>{let O=y(e,b);_n.test(O)&&(O=y(O,en));const B=nn(O).replace(/\/\\\*\\\*/g,`(/${Q}${z}${V}*)*?`).replace(/(\/)?\\\*/g,($,c)=>{const r=`(${z}|(\\.(?!min\\.js$))?)*`;return c?`/${Q}${z}${r}`:r}).replace(/(\/)?\\\?/g,($,c)=>{const r=V;return c?`/${Q}${r}`:r});return new RegExp(`^${B}$`,k)}):void 0;return b=>{if(!g.isAbsolute(b))throw new Error("filePath must be absolute");if(tn&&(b=L(b)),u!=null&&u.includes(b))return n;if(!(!j.some(O=>b.endsWith(O))||F.some(O=>O.test(b)))&&A&&A.some(O=>O.test(b)))return n}};export{Fn as createFilesMatcher,On as createPathsMatcher,an as getTsconfig,J as parseTsconfig};
